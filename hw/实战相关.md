## 如果攻击的回显有延迟或者说攻击生效需要一定的时间 ， 那该怎么通过流量分析判断出攻击是否生效了？

1. 检查数据包，如果有明显的内容异常，如某个端口流量突然增加，可能是攻击生效的表现。

2. 分析日志文件：攻击可能会在系统日志中留下痕迹，例如异常日志、错误日志等，通过分析日志文件可以确定攻击是否生效。以下是实现步骤：

   ```txt
   在Linux上，常见的监控日志包括系统日志（syslog）、安全日志（secure）、应用程序日志等。可以使用以下命令：
   
   查看系统日志（syslog）：使用命令 tail -f /var/log/syslog 可以实时查看系统日志。
   
   查看安全日志（secure）：使用命令 tail -f /var/log/secure 可以实时查看安全日志。
   
   查看应用程序日志：不同的应用程序可能会有不同的日志路径和格式。一般可以在应用程序的配置文件中查看日志路径，例如Apache的日志路径为 /var/log/httpd/。
   
   在Windows上，常见的监控日志包括事件日志、安全日志、应用程序日志等。查询这些日志可以使用以下步骤：
   
   打开事件查看器：在Windows系统中，可以通过“开始菜单”中的“运行”选项或按下Win+R键，输入eventvwr.msc打开事件查看器。
   
   选择要查看的日志类型：在事件查看器中，可以选择查看“Windows 日志”下的不同类型日志，如“应用程序”、“安全”、“系统”等。
   
   过滤日志内容：在事件查看器中，可以使用“筛选器”来过滤日志内容，以便查找特定事件。
   
   总之，无论是在Linux还是Windows系统中，查看监控日志都是非常重要的安全措施。通过查看监控日志，可以及时发现异常事件，及时采取措施保护系统安全。
   ```

   

   ## 应急响应排查思路

   ###### Linux应急响应

   大致流程

   a. 收集信息：收集告警信息、客户反馈信息、设备主机信息等

   b. 判断类型：安全事件类型判断。（钓鱼邮件、Webshll、爆破、中毒等）

   c. 控制范围：隔离失陷设备

   d. 分析研判：根据收集回来的信息进行分析

   e. 处置：根据事件类型进行处置（进程、文件、邮件、启动项、注册表排查等）

   f. 输出报告

   通过日志分析确定攻击时间然后再通过find命令查找相关时间上传或修改的文件

   ###### 很有可能藏有恶意脚本的计划任务文件夹

   /etc/cron.hourly/

   /etc/cron.daily/

   /etc/cron.weekly/

   /etc/cron.monthly/

   /etc/crontab

   /etc/anacrontab

   ###### 系统账号

   查看/etc/passwd文件,是否有可疑的账户

   查看/etc/shadow影子文件（影子文件就是用于存储Linux 系统中用户密码信息的文件）

   last命令查看最近用户的登录信息

   lastb命令可以查看登陆失败的用户信息

   who am i 命令可显示当前登录用户信息，和last命令有所不同

   ###### 启动项

   首先用runlevel查看当前运行级别，然后进入相应的rcX.d文件中查看启动项

   检查启动项中是否存在异常任务,Linux的启动项在/etc/rc.rocal文件和/etc/rc.d/目录下

   ###### 进程

   ps -aux查看进程信息,检查是否存在恶意进程

   -a    显示所有进程
   -u    显示用户名
   -x    显示完整信息
   网络连接

   netstat -antlp查看网络连接,检查是否存在可疑的网络连接

   -a    显示所有选项
   -n    显示数字信息
   -t    显示tcp连接
   -l    显示监听状态的链接
   -p    显示相关的程序名

   也可以用下面命令来查找特定端口号的占用情况

   ```
   netstat -tunlp | grep 端口号
   ```

   分析文件

   检查近期创建或修改的文件,分析可疑的文件，以下是查找所有1天内有更改的文件。

   ```linux
   find / -mtime -1   
   ```

   这命令可以在根目录范围下,搜索1天内修改过的文件

   -ctime    按照文件创建时间搜索(-n指n天内,+n指n天前)
   -mtime    根据文件更改时间搜索(-n指n天内,+n指n天前)
   -atime    根据文件访问时间搜索(-n指n天内,+n指n天前)
   -perm    根据权限查找    find -perm 777

   ###### Windows应急响应

   日志分析

   使用eventvwr.msc查看相关日志

   系统账号

   net user    -- 查看系统账号

   有可疑账号要删除。在控制面板的用户账户进行操作

   启动项

   win+r打开运行窗口,输入shell:startup,检查开机启动项

   计划任务

   cmd输入taskschd.msc,检查计划任务,或者schtasks命令查看计划任务

   进程

   tasklist    -- 查看进程

   taskkill    -- 结束进程

   netstat -ano    -- 查看网络连接

   -a        显示所有端口
   -n        数字形式显示
   -o        显示关联的进程ID

   shift粘滞键后门

   按下5次shift键,检查弹出来的是不是系统的粘滞键

   

   ## 一台主机在内网进行横向攻击，你应该怎么做？

   1.隔离受感染主机：立即隔离受感染的主机，以避免攻击扩散和影响更多的主机。

   ```
   发现受感染的主机可以采取以下方法：
   
   监控网络流量：使用网络流量分析工具，对内网的网络流量进行监控，特别关注异常流量或连接，以及高流量主机。
   可以
   可使用wireshark软件对相关端口进行流量检测，检测异常流量。
   
   检测漏洞：使用漏洞扫描工具或安全漏洞扫描器，对内网主机进行漏洞检测，找到存在漏洞的主机，并及时修复漏洞。工具如：nmap,命令如下：
   nmap -T4 -A -v [ip地址] --script=vuln  
   
   端口扫描：使用端口扫描工具，对内网主机进行端口扫描，发现未授权的服务或服务漏洞，特别是常见的攻击端口。
   如nmap,命令如下：
   nmap -p 1-1023 [ip地址]                只扫描1到1023端口
   nmap -F [ip地址]               这个命令是快速扫描一些常用的端口
   
   日志分析：对网络设备、服务器等进行日志分析，特别是包括主机登录、文件访问、服务开启等，发现异常活动或痕迹。
   
   主机安全软件：在主机上安装安全软件，如杀毒软件、入侵检测系统等，通过实时监控主机的行为和活动，发现异常进程和连接。
   ```

   2.收集攻击信息：记录攻击者的IP地址、攻击方式、攻击时间等信息，以便后续分析和取证。

   ```
   网络流量分析：通过网络流量分析工具，对攻击流量进行分析，找到攻击者的IP地址、攻击目标等信息，比如用wireshark的过滤规则过滤掉无用信息后进行攻击信息的查找。比如Nessus扫描器默认情况下会包含nessus字样、APPscan默认情况下会包含APPscan字样、绿盟极光扫描器一般会包含nsfocus、Rsas字样、sqlmap大多情况下也会包含有sqlmap字样。
   
   邮件头分析：如果攻击者使用了钓鱼邮件等方式进行攻击，可以通过查看邮件头信息，获取攻击者的IP地址、发送邮件的时间等信息。
   
   恶意文件分析：如果攻击者通过发送恶意文件进行攻击，可以对恶意文件进行分析，找到攻击者的IP地址、攻击方式、攻击时间等信息。
   
   系统日志：通过系统日志分析工具，对受攻击主机的系统日志进行分析，查找攻击者的IP地址、攻击方式、攻击时间等信息。
   
   安全设备日志：通过分析安全设备的日志，如入侵检测系统、安全事件管理系统等，获取攻击者的IP地址、攻击方式、攻击时间等信息。
   ```

3. 恢复被攻击主机：对受感染主机进行杀毒、修复漏洞或重装系统等操作，以避免攻击继续发展。

4. 加固安全措施：分析攻击原因，加强安全防护措施，如加强访问控制、更新补丁、加强入侵检测等。

5. 限制网络流量：通过流量分析工具或防火墙等工具，限制异常网络流量和连接，以减轻攻击带来的影响。

   ```
   启用入侵检测系统（IDS）和入侵防御系统（IPS）：IDS和IPS可以监测网络流量和连接，并根据预设规则进行异常流量和连接的阻止和防御，可以使用以下工具启用IDS和IPS：
   Suricata：是一个开源的网络入侵检测和预防系统（NIDS/NIPS），支持多线程和多核CPU，并能够解析多种协议。
   启动Suricata服务：启动suricata服务，使用以下命令：
   sudo suricata -c /etc/suricata/suricata.yaml -i eth0
   
   其中，-c选项指定suricata配置文件路径，-i选项指定要监测的网卡接口。
   ```

6. 进行安全审计：对受攻击的系统进行安全审计和日志分析，以发现其他潜在的安全风险或入侵痕迹。



## Windows日志事件ID

| 事件ID | 说明           |
| :----- | :------------- |
| 4624   | 登陆成功       |
| 4625   | 登陆失败       |
| 4634   | 注销成功       |
| 4647   | 用户启动的注销 |
| 4672   | 使用管理员登陆 |
| 4720   | 创建用户       |



## 安全加固

#### Linux

1、使用命令：

```
vim /etc/login.defs
```

配置密码周期策略

2、应启用登录失败处理功能，可采取结束会话、限制非法登录次数和自动退出等措施。

遭遇密码破解时，暂时锁定帐号，降低密码被猜解的可能性

3、开启审核策略，若日后系统出现故障、安全事故则可以查看系统日志文件，排除故障、追查入侵者的信息等。rsyslog与auditd服务是否开启，输入命令可以检查是否开启：

```
service rsyslog/auditd status
```

如果没有开启用如下命令开启：

```
systemctl start auditd/rsyslog
```

4、关闭蓝牙服务，用以下命令：

```
systemctl stop bluetooth
```

5、防火墙封IP

```
iptables -I INPUT -s 123.45.6.7 -j DROP   #屏蔽单个IP的命令
iptables -I INPUT -s 123.0.0.0/8 -j DROP   #封整个段即从123.0.0.1到123.255.255.254的命令
```



Windows

1、配置密码周期策略
开始—控制面板—管理工具—本地安全策略—帐户策略—密码策略，加固设置

或者win+r键后输入命令：

```
secpol.msc
```

2、关闭默认共享
开始—管理工具—共享和存储管理，右键目标依次停止共享

3、用户权限分配
开始—管理工具—本地安全策略—本地策略—用户权限分配，然后在“关闭系统”这里选择只保留Administrators组

4、关闭不必要服务
开始—管理工具—服务，可禁用如下服务：IP Helper选项禁止

5、安装杀软并更新到最新版

## 中挖矿病毒怎么解决

首先ps -aux查看进程分析 然后top 分析算力，挖矿用到的算力比较多，对流量进行过滤，含有矿池服务器的流量就是挖矿病毒 最后kill进程，删（rm）掉程序

删不掉怎么办？

删不掉：确认一下一下是因为程序在使用，还是权限不够，更具具体情况采取措施 直接降权，降权到没有执行权限

## 中勒索病毒怎么解决

首先判断是否是勒索病毒攻击：

```
1、业务系统无法访问
2、文件后缀被篡改
操作系统在遭遇勒索病毒攻击后，一般受害机器中的可执行文件、文档等都会被病毒修改成特定的后缀名。
3、勒索信展示
遭受勒索病毒攻击后，受害者通常会在桌面或者磁盘根目录找到勒索信。
```

1、确定后先断网隔离被感染的服务器/主机

2、确定感染的时间，可以通过加密文件修改时间和勒索信建立时间来进行推断

3、将未受感染的服务器3389、445等高危端口进行关闭，开启防火墙和设置复杂密码

4、在检测过程中，可以将疑似样本送入沙箱进行分析，确定勒索病毒类型和攻击者的一些遗留信息，还可以对日志进行分析，查看是否有IP有可疑行为，进行溯源处理，然后如果是Windows系统的话还可以使用systeminfo命令查看系统补丁。

5、对攻击者遗留的一些信息进行溯源

6、然后进行常规的应急响应排查



## 怎么去分析告警数据流中是否存在真正的攻击危险行为？

可以排除「待分析告警」中那些真实的攻击尝试行为，却又未攻击成功的告警。（在通常情况下，可以把告警中的URL的“网页状态码”、“页面回显数据”作为「误报告警」判断的条件之一，一般真实攻击会有正常的请求包和回应包）

然后，人工再对剩余的少量「待分析告警」中提取攻击特征，通过「攻击特征规则库」进行匹配，看能否获取到「情报线索」。常见的攻击特征特征规则库有微步威胁情报中心。

## 网站后台getshell的方法有哪些？

一、利用文件上传漏洞

上传大小马，记住文件路径后用菜刀或蚁剑进行连接即可

二、利用sql注入漏洞

先利用报错注入的原理，使用错误语句让网站根目录暴露，然后在sql语句中加上语句语句get shell

三、通过文件包含

先将webshell改为txt文件上传，然后上传一个脚本文件包含该txt文件，可以绕过waf拿webshell

## 常规渗透流程

1、信息收集 

将域名进行指纹分析来识别出目标的CMS系统、服务器、开发语言、操作系统、CDN、WAF类别版本等等，将域名放上站长之家进行分析，得出邮箱、IP等信息，在获取IP过程中如果有CDN的话去DNS解析记录上查看，或者多地PING的网站看PING 出来的IP出现频率最高的那个就有可能是，当然通过子域名来进行查询也是一个方法。然后通过邮箱去查找名下所有域名和社工手段收集信息，IP可以利用网站定位服务器所在地和用NMAP来扫描开放端口和可能存在漏洞，同时可以用子域名挖掘机或御剑来挖掘一些可用子域名，后期可能用得到。天眼查和域名备案也能获取很多的信息，像注册人电话邮箱，地址等。

用fofa，鹰图，zoomeye这些网站可以直接进行资产测绘，得到相关信息。

2、漏洞探测（挖掘）

用BP、sqlmap、nmap、Nessus、MSF等软件扫描出可利用漏洞

3、漏洞验证（利用）

将上述工具扫描出来的漏洞进行手工复现测试，也可以用MSF来进行自动化测试

4、提升权限

5、清除痕迹

清楚痕迹主要是清除渗透过程中操作的一些痕迹，如添加的测试账号，上传的测试文件等，比如要清除Windows日志记录，你可以用`wevtutil`命令清除；还有Linux中用`history-c`这个命令来清除历史使用命令，当然这个命令清除的不完全，你可以使用`rm .bash_history`来完全清除。

6、编写渗透测试报告

根据渗透测试具体情况编写渗透测试报告，说清楚渗透清单（范围），攻击路径，渗透成果，以及详细的漏洞详情（相关描述、漏洞危害等）及可行的修复建议，最后对整改渗透情况进行简单的总结和分析，说清楚目前资产的一个状况是什么样的，应该从哪些方面进行加强和提升。
